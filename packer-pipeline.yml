trigger: none

pool:
  vmImage: windows-latest


stages:
  - stage: Install and build packer stage
    jobs:
      - job: installandbuildimage
        steps:
          - powershell: |

                $url = "https://releases.hashicorp.com/packer/1.8.2/packer_1.8.2_windows_amd64.zip"
                $outpath = "$(System.DefaultWorkingDirectory)/packer_1.8.2_windows_amd64.zip"
                Invoke-WebRequest -Uri $url -OutFile $outpath -Verbose

                Expand-Archive "$(System.DefaultWorkingDirectory)/packer_1.8.2_windows_amd64.zip" -DestinationPath "$(System.DefaultWorkingDirectory)/packer_1.8.2_windows_amd64" -Verbose

                $(System.DefaultWorkingDirectory)/packer_1.8.2_windows_amd64/packer.exe --version 
                
                $(System.DefaultWorkingDirectory)/packer_1.8.2_windows_amd64/packer.exe init $(System.DefaultWorkingDirectory)
                

            displayName: download and install packer
